<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Web Absen Sidik Jari</title>
<!-- Tailwind CSS CDN -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- SweetAlert2 CDN -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
  body {
    font-family: 'Poppins', sans-serif;
  }
  .fingerprint-icon-gray {
    stroke: #6b7280; /* Tailwind gray-500 */
    fill: transparent;
  }
  .fingerprint-icon-green {
    stroke: #22c55e; /* Tailwind green-500 */
    fill: transparent;
  }
</style>
</head>
<body class="bg-gradient-to-b from-blue-400 via-blue-300 to-blue-500 min-h-screen flex items-center justify-center px-4" style="max-width: 350px; margin: auto; height: 100vh;">

  <div class="bg-white/90 backdrop-blur-md rounded-xl shadow-lg p-6 w-full max-w-xs">
    <h1 class="text-3xl font-bold text-center text-blue-700 mb-4 select-none">Absen Sidik Jari</h1>
    <p class="text-center text-blue-800 mb-6">Tekan tombol di bawah untuk scan sidik jari menggunakan sensor bawaan HP.</p>
    <div class="flex justify-center">
      <button id="scanBtn" aria-label="Mulai scan sidik jari" class="group relative bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 focus:outline-none text-white font-semibold py-3 px-6 rounded-lg shadow-md flex items-center space-x-3 transition-all duration-300">
        <!-- Fingerprint icon -->
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 group-hover:animate-pulse" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 11c.667 0 1-.333 1-1V7a5 5 0 00-10 0v3c0 .667.333 1 1 1 .533 0 1-.267 1-1V7a3 3 0 016 0v3c0 .733.467 1 1 1z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 13c-1 0-2 .5-2 2v2h4v-2c0-1.5-1-2-2-2z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M7 19v2h10v-2" />
        </svg>
        <span>Scan Sidik Jari</span>
      </button>
    </div>
    <p id="status" class="text-center mt-6 text-sm text-gray-700 select-none">Status: Menunggu scan.</p>
  </div>

<script>
  const scanBtn = document.getElementById('scanBtn');
  const statusText = document.getElementById('status');

  function fingerprintSVG(colorClass) {
    return \`
    <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto my-4 h-24 w-24 \${colorClass}" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor">
      <path d="M12 11c.667 0 1-.333 1-1V7a5 5 0 00-10 0v3c0 .667.333 1 1 1 .533 0 1-.267 1-1V7a3 3 0 016 0v3c0 .733.467 1 1 1z" />
      <path d="M12 13c-1 0-2 .5-2 2v2h4v-2c0-1.5-1-2-2-2z" />
      <path d="M7 19v2h10v-2" />
    </svg>
    \`;
  }

  async function scanFingerprint() {
    if (!window.PublicKeyCredential) {
      Swal.fire({
        icon: 'error',
        title: 'Perangkat tidak mendukung WebAuthn',
        text: 'Fitur sidik jari tidak tersedia di browser ini.',
        confirmButtonColor: '#2563eb'
      });
      statusText.textContent = 'Status: WebAuthn tidak didukung.';
      return;
    }

    Swal.fire({
      title: 'Silakan scan sidik jari Anda',
      html: fingerprintSVG('fingerprint-icon-gray') + '<p class="text-center mt-2 text-gray-700 select-none">Scan sidik jari menggunakan sensor bawaan HP</p>',
      showConfirmButton: false,
      allowOutsideClick: false,
      allowEscapeKey: false,
      didOpen: () => {
        setTimeout(() => triggerWebAuthn(), 300); // slight delay for UI to update before starting
      }
    });
  }

  async function triggerWebAuthn() {
    try {
      const challenge = new Uint8Array(32);
      window.crypto.getRandomValues(challenge);

      const publicKey = {
        challenge: challenge.buffer,
        timeout: 60000,
        userVerification: 'required',
      };

      console.log('Triggering WebAuthn with options:', publicKey);

      const credential = await navigator.credentials.get({ publicKey });

      console.log('WebAuthn credential:', credential);

      Swal.update({
        html: fingerprintSVG('fingerprint-icon-green') + '<p class="text-center mt-2 text-green-700 font-semibold select-none">Berhasil scan sidik jari, absensi tercatat!</p>',
        icon: 'success',
        showConfirmButton: true,
        confirmButtonText: 'OK',
      });
      statusText.textContent = 'Status: Absen berhasil.';
    } catch (err) {
      console.error('WebAuthn error:', err);
      if (err.name === 'NotAllowedError') {
        Swal.update({
          html: fingerprintSVG('fingerprint-icon-gray') + '<p class="text-center mt-2 text-gray-700 select-none">Scan dibatalkan atau gagal. Silakan coba lagi.</p>',
          icon: 'warning',
          showConfirmButton: true,
          confirmButtonText: 'OK',
        });
        statusText.textContent = 'Status: Scan dibatalkan.';
      } else {
        Swal.update({
          html: fingerprintSVG('fingerprint-icon-gray') + '<p class="text-center mt-2 text-red-600 select-none">Terjadi kesalahan: ' + err.message + '</p>',
          icon: 'error',
          showConfirmButton: true,
          confirmButtonText: 'OK',
        });
        statusText.textContent = 'Status: Terjadi kesalahan.';
      }
    }
  }

  scanBtn.addEventListener('click', () => {
    console.log('Scan button clicked');
    statusText.textContent = 'Status: Memulai proses scan...';
    scanFingerprint();
  });
</script>

</body>
</html>

